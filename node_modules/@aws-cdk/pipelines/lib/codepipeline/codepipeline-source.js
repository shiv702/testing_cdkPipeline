"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipelineSource = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const cp_actions = require("@aws-cdk/aws-codepipeline-actions");
const core_1 = require("@aws-cdk/core");
const constructs_1 = require("constructs");
const blueprint_1 = require("../blueprint");
const outputs_1 = require("./private/outputs");
/**
 * Factory for CodePipeline source steps
 *
 * This class contains a number of factory methods for the different types
 * of sources that CodePipeline supports.
 */
class CodePipelineSource extends blueprint_1.Step {
    constructor() {
        super(...arguments);
        // tells `PipelineGraph` to hoist a "Source" step
        this.isSource = true;
    }
    /**
     * Returns a GitHub source, using OAuth tokens to authenticate with
     * GitHub and a separate webhook to detect changes. This is no longer
     * the recommended method. Please consider using `connection()`
     * instead.
     *
     * Pass in the owner and repository in a single string, like this:
     *
     * ```ts
     * pipelines.CodePipelineSource.gitHub('owner/repo', 'main');
     * ```
     *
     * Authentication will be done by a secret called `github-token` in AWS
     * Secrets Manager (unless specified otherwise).
     *
     * The token should have these permissions:
     *
     * * **repo** - to read the repository
     * * **admin:repo_hook** - if you plan to use webhooks (true by default)
     *
     * If you need access to symlinks or the repository history, use a source of type
     * `connection` instead.
     */
    static gitHub(repoString, branch, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_GitHubSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.gitHub);
            }
            throw error;
        }
        return new GitHubSource(repoString, branch, props);
    }
    /**
     * Returns an S3 source.
     *
     * @param bucket The bucket where the source code is located.
     * @param props The options, which include the key that identifies the source code file and
     * and how the pipeline should be triggered.
     *
     * @example
     * declare const bucket: s3.Bucket;
     * pipelines.CodePipelineSource.s3(bucket, 'path/to/file.zip');
     */
    static s3(bucket, objectKey, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_S3SourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.s3);
            }
            throw error;
        }
        return new S3Source(bucket, objectKey, props);
    }
    /**
     * Returns an ECR source.
     *
     * @param repository The repository that will be watched for changes.
     * @param props The options, which include the image tag to be checked for changes.
     *
     * @example
     * declare const repository: ecr.IRepository;
     * pipelines.CodePipelineSource.ecr(repository, {
     *   imageTag: 'latest',
     * });
     */
    static ecr(repository, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_ECRSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.ecr);
            }
            throw error;
        }
        return new ECRSource(repository, props);
    }
    /**
     * Returns a CodeStar connection source. A CodeStar connection allows AWS CodePipeline to
     * access external resources, such as repositories in GitHub, GitHub Enterprise or
     * BitBucket.
     *
     * To use this method, you first need to create a CodeStar connection
     * using the AWS console. In the process, you may have to sign in to the external provider
     * -- GitHub, for example -- to authorize AWS to read and modify your repository.
     * Once you have done this, copy the connection ARN and use it to create the source.
     *
     * Example:
     *
     * ```ts
     * pipelines.CodePipelineSource.connection('owner/repo', 'main', {
     *   connectionArn: 'arn:aws:codestar-connections:us-east-1:222222222222:connection/7d2469ff-514a-4e4f-9003-5ca4a43cdc41', // Created using the AWS console
     * });
     * ```
     *
     * If you need access to symlinks or the repository history, be sure to set
     * `codeBuildCloneOutput`.
     *
     * @param repoString A string that encodes owner and repository separated by a slash (e.g. 'owner/repo').
     * @param branch The branch to use.
     * @param props The source properties, including the connection ARN.
     *
     * @see https://docs.aws.amazon.com/dtconsole/latest/userguide/welcome-connections.html
     */
    static connection(repoString, branch, props) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_ConnectionSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.connection);
            }
            throw error;
        }
        return new CodeStarConnectionSource(repoString, branch, props);
    }
    /**
     * Returns a CodeCommit source.
     *
     * If you need access to symlinks or the repository history, be sure to set
     * `codeBuildCloneOutput`.
     *
     *
     * @param repository The CodeCommit repository.
     * @param branch The branch to use.
     * @param props The source properties.
     *
     * @example
     * declare const repository: codecommit.IRepository;
     * pipelines.CodePipelineSource.codeCommit(repository, 'main');
     */
    static codeCommit(repository, branch, props = {}) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_CodeCommitSourceOptions(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.codeCommit);
            }
            throw error;
        }
        return new CodeCommitSource(repository, branch, props);
    }
    produceAction(stage, options) {
        try {
            jsiiDeprecationWarnings._aws_cdk_pipelines_ProduceActionOptions(options);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.produceAction);
            }
            throw error;
        }
        const output = options.artifacts.toCodePipeline(this.primaryOutput);
        const action = this.getAction(output, options.actionName, options.runOrder, options.variablesNamespace);
        stage.addAction(action);
        return { runOrdersConsumed: 1 };
    }
    /**
     * Return an attribute of the current source revision
     *
     * These values can be passed into the environment variables of pipeline steps,
     * so your steps can access information about the source revision.
     *
     * Pipeline synth step has some source attributes predefined in the environment.
     * If these suffice, you don't need to use this method for the synth step.
     * @see https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-env-vars.html
     *
     * What attributes are available depends on the type of source. These attributes
     * are supported:
     *
     * - GitHub, CodeCommit, and CodeStarSourceConnection
     *   - `AuthorDate`
     *   - `BranchName`
     *   - `CommitId`
     *   - `CommitMessage`
     * - GitHub, CodeCommit and ECR
     *   - `RepositoryName`
     * - GitHub and CodeCommit
     *   - `CommitterDate`
     * - GitHub
     *   - `CommitUrl`
     * - CodeStarSourceConnection
     *   - `FullRepositoryName`
     * - S3
     *   - `ETag`
     *   - `VersionId`
     * - ECR
     *   - `ImageDigest`
     *   - `ImageTag`
     *   - `ImageURI`
     *   - `RegistryId`
     *
     * @see https://docs.aws.amazon.com/codepipeline/latest/userguide/reference-variables.html#reference-variables-list
     * @example
     * // Access the CommitId of a GitHub source in the synth
     * const source = pipelines.CodePipelineSource.gitHub('owner/repo', 'main');
     *
     * const pipeline = new pipelines.CodePipeline(scope, 'MyPipeline', {
     *   synth: new pipelines.ShellStep('Synth', {
     *     input: source,
     *     commands: [],
     *     env: {
     *       'COMMIT_ID': source.sourceAttribute('CommitId'),
     *     }
     *   })
     * });
     */
    sourceAttribute(name) {
        return outputs_1.makeCodePipelineOutput(this, name);
    }
}
exports.CodePipelineSource = CodePipelineSource;
_a = JSII_RTTI_SYMBOL_1;
CodePipelineSource[_a] = { fqn: "@aws-cdk/pipelines.CodePipelineSource", version: "1.204.0" };
/**
 * Extend CodePipelineSource so we can type-test in the CodePipelineEngine.
 */
class GitHubSource extends CodePipelineSource {
    constructor(repoString, branch, props) {
        super(repoString);
        this.branch = branch;
        this.props = props;
        const parts = repoString.split('/');
        if (core_1.Token.isUnresolved(repoString) || parts.length !== 2) {
            throw new Error(`GitHub repository name should be a resolved string like '<owner>/<repo>', got '${repoString}'`);
        }
        this.owner = parts[0];
        this.repo = parts[1];
        this.authentication = props.authentication ?? core_1.SecretValue.secretsManager('github-token');
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, actionName, runOrder, variablesNamespace) {
        return new cp_actions.GitHubSourceAction({
            output,
            actionName,
            runOrder,
            oauthToken: this.authentication,
            owner: this.owner,
            repo: this.repo,
            branch: this.branch,
            trigger: this.props.trigger,
            variablesNamespace,
        });
    }
}
class S3Source extends CodePipelineSource {
    constructor(bucket, objectKey, props) {
        super(constructs_1.Node.of(bucket).addr);
        this.bucket = bucket;
        this.objectKey = objectKey;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        return new cp_actions.S3SourceAction({
            output,
            // Bucket names are guaranteed to conform to ActionName restrictions
            actionName: this.props.actionName ?? this.bucket.bucketName,
            runOrder,
            bucketKey: this.objectKey,
            trigger: this.props.trigger,
            bucket: this.bucket,
            variablesNamespace,
        });
    }
}
class ECRSource extends CodePipelineSource {
    constructor(repository, props) {
        super(constructs_1.Node.of(repository).addr);
        this.repository = repository;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        // RepositoryName can contain '/' that is not a valid ActionName character, use '_' instead
        const formattedRepositoryName = core_1.Fn.join('_', core_1.Fn.split('/', this.repository.repositoryName));
        return new cp_actions.EcrSourceAction({
            output,
            actionName: this.props.actionName ?? formattedRepositoryName,
            runOrder,
            repository: this.repository,
            imageTag: this.props.imageTag,
            variablesNamespace,
        });
    }
}
class CodeStarConnectionSource extends CodePipelineSource {
    constructor(repoString, branch, props) {
        super(repoString);
        this.branch = branch;
        this.props = props;
        const parts = repoString.split('/');
        if (core_1.Token.isUnresolved(repoString) || parts.length !== 2) {
            throw new Error(`CodeStar repository name should be a resolved string like '<owner>/<repo>', got '${repoString}'`);
        }
        this.owner = parts[0];
        this.repo = parts[1];
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, actionName, runOrder, variablesNamespace) {
        return new cp_actions.CodeStarConnectionsSourceAction({
            output,
            actionName,
            runOrder,
            connectionArn: this.props.connectionArn,
            owner: this.owner,
            repo: this.repo,
            branch: this.branch,
            codeBuildCloneOutput: this.props.codeBuildCloneOutput,
            triggerOnPush: this.props.triggerOnPush,
            variablesNamespace,
        });
    }
}
class CodeCommitSource extends CodePipelineSource {
    constructor(repository, branch, props) {
        super(core_1.Token.isUnresolved(repository.repositoryName)
            ? constructs_1.Node.of(repository).addr
            : repository.repositoryName);
        this.repository = repository;
        this.branch = branch;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        return new cp_actions.CodeCommitSourceAction({
            output,
            // Guaranteed to be okay as action name
            actionName: this.repository.repositoryName,
            runOrder,
            branch: this.branch,
            trigger: this.props.trigger,
            repository: this.repository,
            eventRole: this.props.eventRole,
            codeBuildCloneOutput: this.props.codeBuildCloneOutput,
            variablesNamespace,
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvZGVwaXBlbGluZS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBR0EsZ0VBQWdFO0FBS2hFLHdDQUF1RDtBQUN2RCwyQ0FBa0M7QUFDbEMsNENBQTZDO0FBRTdDLCtDQUEyRDtBQUUzRDs7Ozs7R0FLRztBQUNILE1BQXNCLGtCQUFtQixTQUFRLGdCQUFJO0lBQXJEOztRQTZHRSxpREFBaUQ7UUFDakMsYUFBUSxHQUFHLElBQUksQ0FBQztLQWlFakM7SUE5S0M7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0FzQkc7SUFDSSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQWtCLEVBQUUsTUFBYyxFQUFFLFFBQTZCLEVBQUU7Ozs7Ozs7Ozs7UUFDdEYsT0FBTyxJQUFJLFlBQVksQ0FBQyxVQUFVLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ3BEO0lBRUQ7Ozs7Ozs7Ozs7T0FVRztJQUNJLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBZSxFQUFFLFNBQWlCLEVBQUUsUUFBeUIsRUFBRTs7Ozs7Ozs7OztRQUM5RSxPQUFPLElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDL0M7SUFFRDs7Ozs7Ozs7Ozs7T0FXRztJQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBdUIsRUFBRSxRQUEwQixFQUFFOzs7Ozs7Ozs7O1FBQ3JFLE9BQU8sSUFBSSxTQUFTLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ3pDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BMEJHO0lBQ0ksTUFBTSxDQUFDLFVBQVUsQ0FBQyxVQUFrQixFQUFFLE1BQWMsRUFBRSxLQUE4Qjs7Ozs7Ozs7OztRQUN6RixPQUFPLElBQUksd0JBQXdCLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztL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QUFLLENBQUMsb0JBQW9CO1lBQ3JELGtCQUFrQjtTQUNuQixDQUFDLENBQUM7S0FDSjtDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY29kZWNvbW1pdCBmcm9tICdAYXdzLWNkay9hd3MtY29kZWNvbW1pdCc7XG5pbXBvcnQgKiBhcyBjcCBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCB7IEFydGlmYWN0IH0gZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVwaXBlbGluZSc7XG5pbXBvcnQgKiBhcyBjcF9hY3Rpb25zIGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlcGlwZWxpbmUtYWN0aW9ucyc7XG5pbXBvcnQgeyBBY3Rpb24sIENvZGVDb21taXRUcmlnZ2VyLCBHaXRIdWJUcmlnZ2VyLCBTM1RyaWdnZXIgfSBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lLWFjdGlvbnMnO1xuaW1wb3J0IHsgSVJlcG9zaXRvcnkgfSBmcm9tICdAYXdzLWNkay9hd3MtZWNyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdAYXdzLWNkay9hd3MtaWFtJztcbmltcG9ydCB7IElCdWNrZXQgfSBmcm9tICdAYXdzLWNkay9hd3MtczMnO1xuaW1wb3J0IHsgRm4sIFNlY3JldFZhbHVlLCBUb2tlbiB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgRmlsZVNldCwgU3RlcCB9IGZyb20gJy4uL2JsdWVwcmludCc7XG5pbXBvcnQgeyBDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5UmVzdWx0LCBQcm9kdWNlQWN0aW9uT3B0aW9ucywgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkgfSBmcm9tICcuL2NvZGVwaXBlbGluZS1hY3Rpb24tZmFjdG9yeSc7XG5pbXBvcnQgeyBtYWtlQ29kZVBpcGVsaW5lT3V0cHV0IH0gZnJvbSAnLi9wcml2YXRlL291dHB1dHMnO1xuXG4vKipcbiAqIEZhY3RvcnkgZm9yIENvZGVQaXBlbGluZSBzb3VyY2Ugc3RlcHNcbiAqXG4gKiBUaGlzIGNsYXNzIGNvbnRhaW5zIGEgbnVtYmVyIG9mIGZhY3RvcnkgbWV0aG9kcyBmb3IgdGhlIGRpZmZlcmVudCB0eXBlc1xuICogb2Ygc291cmNlcyB0aGF0IENvZGVQaXBlbGluZSBzdXBwb3J0cy5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENvZGVQaXBlbGluZVNvdXJjZSBleHRlbmRzIFN0ZXAgaW1wbGVtZW50cyBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgR2l0SHViIHNvdXJjZSwgdXNpbmcgT0F1dGggdG9rZW5zIHRvIGF1dGhlbnRpY2F0ZSB3aXRoXG4gICAqIEdpdEh1YiBhbmQgYSBzZXBhcmF0ZSB3ZWJob29rIHRvIGRldGVjdCBjaGFuZ2VzLiBUaGlzIGlzIG5vIGxvbmdlclxuICAgKiB0aGUgcmVjb21tZW5kZWQgbWV0aG9kLiBQbGVhc2UgY29uc2lkZXIgdXNpbmcgYGNvbm5lY3Rpb24oKWBcbiAgICogaW5zdGVhZC5cbiAgICpcbiAgICogUGFzcyBpbiB0aGUgb3duZXIgYW5kIHJlcG9zaXRvcnkgaW4gYSBzaW5nbGUgc3RyaW5nLCBsaWtlIHRoaXM6XG4gICAqXG4gICAqIGBgYHRzXG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuZ2l0SHViKCdvd25lci9yZXBvJywgJ21haW4nKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEF1dGhlbnRpY2F0aW9uIHdpbGwgYmUgZG9uZSBieSBhIHNlY3JldCBjYWxsZWQgYGdpdGh1Yi10b2tlbmAgaW4gQVdTXG4gICAqIFNlY3JldHMgTWFuYWdlciAodW5sZXNzIHNwZWNpZmllZCBvdGhlcndpc2UpLlxuICAgKlxuICAgKiBUaGUgdG9rZW4gc2hvdWxkIGhhdmUgdGhlc2UgcGVybWlzc2lvbnM6XG4gICAqXG4gICAqICogKipyZXBvKiogLSB0byByZWFkIHRoZSByZXBvc2l0b3J5XG4gICAqICogKiphZG1pbjpyZXBvX2hvb2sqKiAtIGlmIHlvdSBwbGFuIHRvIHVzZSB3ZWJob29rcyAodHJ1ZSBieSBkZWZhdWx0KVxuICAgKlxuICAgKiBJZiB5b3UgbmVlZCBhY2Nlc3MgdG8gc3ltbGlua3Mgb3IgdGhlIHJlcG9zaXRvcnkgaGlzdG9yeSwgdXNlIGEgc291cmNlIG9mIHR5cGVcbiAgICogYGNvbm5lY3Rpb25gIGluc3RlYWQuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdpdEh1YihyZXBvU3RyaW5nOiBzdHJpbmcsIGJyYW5jaDogc3RyaW5nLCBwcm9wczogR2l0SHViU291cmNlT3B0aW9ucyA9IHt9KTogQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgICByZXR1cm4gbmV3IEdpdEh1YlNvdXJjZShyZXBvU3RyaW5nLCBicmFuY2gsIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIFMzIHNvdXJjZS5cbiAgICpcbiAgICogQHBhcmFtIGJ1Y2tldCBUaGUgYnVja2V0IHdoZXJlIHRoZSBzb3VyY2UgY29kZSBpcyBsb2NhdGVkLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIG9wdGlvbnMsIHdoaWNoIGluY2x1ZGUgdGhlIGtleSB0aGF0IGlkZW50aWZpZXMgdGhlIHNvdXJjZSBjb2RlIGZpbGUgYW5kXG4gICAqIGFuZCBob3cgdGhlIHBpcGVsaW5lIHNob3VsZCBiZSB0cmlnZ2VyZWQuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGRlY2xhcmUgY29uc3QgYnVja2V0OiBzMy5CdWNrZXQ7XG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuczMoYnVja2V0LCAncGF0aC90by9maWxlLnppcCcpO1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBzMyhidWNrZXQ6IElCdWNrZXQsIG9iamVjdEtleTogc3RyaW5nLCBwcm9wczogUzNTb3VyY2VPcHRpb25zID0ge30pOiBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgUzNTb3VyY2UoYnVja2V0LCBvYmplY3RLZXksIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGFuIEVDUiBzb3VyY2UuXG4gICAqXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5IFRoZSByZXBvc2l0b3J5IHRoYXQgd2lsbCBiZSB3YXRjaGVkIGZvciBjaGFuZ2VzLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIG9wdGlvbnMsIHdoaWNoIGluY2x1ZGUgdGhlIGltYWdlIHRhZyB0byBiZSBjaGVja2VkIGZvciBjaGFuZ2VzLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBkZWNsYXJlIGNvbnN0IHJlcG9zaXRvcnk6IGVjci5JUmVwb3NpdG9yeTtcbiAgICogcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5lY3IocmVwb3NpdG9yeSwge1xuICAgKiAgIGltYWdlVGFnOiAnbGF0ZXN0JyxcbiAgICogfSk7XG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGVjcihyZXBvc2l0b3J5OiBJUmVwb3NpdG9yeSwgcHJvcHM6IEVDUlNvdXJjZU9wdGlvbnMgPSB7fSk6IENvZGVQaXBlbGluZVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBFQ1JTb3VyY2UocmVwb3NpdG9yeSwgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBDb2RlU3RhciBjb25uZWN0aW9uIHNvdXJjZS4gQSBDb2RlU3RhciBjb25uZWN0aW9uIGFsbG93cyBBV1MgQ29kZVBpcGVsaW5lIHRvXG4gICAqIGFjY2VzcyBleHRlcm5hbCByZXNvdXJjZXMsIHN1Y2ggYXMgcmVwb3NpdG9yaWVzIGluIEdpdEh1YiwgR2l0SHViIEVudGVycHJpc2Ugb3JcbiAgICogQml0QnVja2V0LlxuICAgKlxuICAgKiBUbyB1c2UgdGhpcyBtZXRob2QsIHlvdSBmaXJzdCBuZWVkIHRvIGNyZWF0ZSBhIENvZGVTdGFyIGNvbm5lY3Rpb25cbiAgICogdXNpbmcgdGhlIEFXUyBjb25zb2xlLiBJbiB0aGUgcHJvY2VzcywgeW91IG1heSBoYXZlIHRvIHNpZ24gaW4gdG8gdGhlIGV4dGVybmFsIHByb3ZpZGVyXG4gICAqIC0tIEdpdEh1YiwgZm9yIGV4YW1wbGUgLS0gdG8gYXV0aG9yaXplIEFXUyB0byByZWFkIGFuZCBtb2RpZnkgeW91ciByZXBvc2l0b3J5LlxuICAgKiBPbmNlIHlvdSBoYXZlIGRvbmUgdGhpcywgY29weSB0aGUgY29ubmVjdGlvbiBBUk4gYW5kIHVzZSBpdCB0byBjcmVhdGUgdGhlIHNvdXJjZS5cbiAgICpcbiAgICogRXhhbXBsZTpcbiAgICpcbiAgICogYGBgdHNcbiAgICogcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5jb25uZWN0aW9uKCdvd25lci9yZXBvJywgJ21haW4nLCB7XG4gICAqICAgY29ubmVjdGlvbkFybjogJ2Fybjphd3M6Y29kZXN0YXItY29ubmVjdGlvbnM6dXMtZWFzdC0xOjIyMjIyMjIyMjIyMjpjb25uZWN0aW9uLzdkMjQ2OWZmLTUxNGEtNGU0Zi05MDAzLTVjYTRhNDNjZGM0MScsIC8vIENyZWF0ZWQgdXNpbmcgdGhlIEFXUyBjb25zb2xlXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICpcbiAgICogSWYgeW91IG5lZWQgYWNjZXNzIHRvIHN5bWxpbmtzIG9yIHRoZSByZXBvc2l0b3J5IGhpc3RvcnksIGJlIHN1cmUgdG8gc2V0XG4gICAqIGBjb2RlQnVpbGRDbG9uZU91dHB1dGAuXG4gICAqXG4gICAqIEBwYXJhbSByZXBvU3RyaW5nIEEgc3RyaW5nIHRoYXQgZW5jb2RlcyBvd25lciBhbmQgcmVwb3NpdG9yeSBzZXBhcmF0ZWQgYnkgYSBzbGFzaCAoZS5nLiAnb3duZXIvcmVwbycpLlxuICAgKiBAcGFyYW0gYnJhbmNoIFRoZSBicmFuY2ggdG8gdXNlLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIHNvdXJjZSBwcm9wZXJ0aWVzLCBpbmNsdWRpbmcgdGhlIGNvbm5lY3Rpb24gQVJOLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9kdGNvbnNvbGUvbGF0ZXN0L3VzZXJndWlkZS93ZWxjb21lLWNvbm5lY3Rpb25zLmh0bWxcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgY29ubmVjdGlvbihyZXBvU3RyaW5nOiBzdHJpbmcsIGJyYW5jaDogc3RyaW5nLCBwcm9wczogQ29ubmVjdGlvblNvdXJjZU9wdGlvbnMpOiBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgQ29kZVN0YXJDb25uZWN0aW9uU291cmNlKHJlcG9TdHJpbmcsIGJyYW5jaCwgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBDb2RlQ29tbWl0IHNvdXJjZS5cbiAgICpcbiAgICogSWYgeW91IG5lZWQgYWNjZXNzIHRvIHN5bWxpbmtzIG9yIHRoZSByZXBvc2l0b3J5IGhpc3RvcnksIGJlIHN1cmUgdG8gc2V0XG4gICAqIGBjb2RlQnVpbGRDbG9uZU91dHB1dGAuXG4gICAqXG4gICAqXG4gICAqIEBwYXJhbSByZXBvc2l0b3J5IFRoZSBDb2RlQ29tbWl0IHJlcG9zaXRvcnkuXG4gICAqIEBwYXJhbSBicmFuY2ggVGhlIGJyYW5jaCB0byB1c2UuXG4gICAqIEBwYXJhbSBwcm9wcyBUaGUgc291cmNlIHByb3BlcnRpZXMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGRlY2xhcmUgY29uc3QgcmVwb3NpdG9yeTogY29kZWNvbW1pdC5JUmVwb3NpdG9yeTtcbiAgICogcGlwZWxpbmVzLkNvZGVQaXBlbGluZVNvdXJjZS5jb2RlQ29tbWl0KHJlcG9zaXRvcnksICdtYWluJyk7XG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGNvZGVDb21taXQocmVwb3NpdG9yeTogY29kZWNvbW1pdC5JUmVwb3NpdG9yeSwgYnJhbmNoOiBzdHJpbmcsIHByb3BzOiBDb2RlQ29tbWl0U291cmNlT3B0aW9ucyA9IHt9KTogQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgICByZXR1cm4gbmV3IENvZGVDb21taXRTb3VyY2UocmVwb3NpdG9yeSwgYnJhbmNoLCBwcm9wcyk7XG4gIH1cblxuICAvLyB0ZWxscyBgUGlwZWxpbmVHcmFwaGAgdG8gaG9pc3QgYSBcIlNvdXJjZVwiIHN0ZXBcbiAgcHVibGljIHJlYWRvbmx5IGlzU291cmNlID0gdHJ1ZTtcblxuICBwdWJsaWMgcHJvZHVjZUFjdGlvbihzdGFnZTogY3AuSVN0YWdlLCBvcHRpb25zOiBQcm9kdWNlQWN0aW9uT3B0aW9ucyk6IENvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnlSZXN1bHQge1xuICAgIGNvbnN0IG91dHB1dCA9IG9wdGlvbnMuYXJ0aWZhY3RzLnRvQ29kZVBpcGVsaW5lKHRoaXMucHJpbWFyeU91dHB1dCEpO1xuXG4gICAgY29uc3QgYWN0aW9uID0gdGhpcy5nZXRBY3Rpb24ob3V0cHV0LCBvcHRpb25zLmFjdGlvbk5hbWUsIG9wdGlvbnMucnVuT3JkZXIsIG9wdGlvbnMudmFyaWFibGVzTmFtZXNwYWNlKTtcbiAgICBzdGFnZS5hZGRBY3Rpb24oYWN0aW9uKTtcbiAgICByZXR1cm4geyBydW5PcmRlcnNDb25zdW1lZDogMSB9O1xuICB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBhY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZyk6IEFjdGlvbjtcblxuICAvKipcbiAgICogUmV0dXJuIGFuIGF0dHJpYnV0ZSBvZiB0aGUgY3VycmVudCBzb3VyY2UgcmV2aXNpb25cbiAgICpcbiAgICogVGhlc2UgdmFsdWVzIGNhbiBiZSBwYXNzZWQgaW50byB0aGUgZW52aXJvbm1lbnQgdmFyaWFibGVzIG9mIHBpcGVsaW5lIHN0ZXBzLFxuICAgKiBzbyB5b3VyIHN0ZXBzIGNhbiBhY2Nlc3MgaW5mb3JtYXRpb24gYWJvdXQgdGhlIHNvdXJjZSByZXZpc2lvbi5cbiAgICpcbiAgICogUGlwZWxpbmUgc3ludGggc3RlcCBoYXMgc29tZSBzb3VyY2UgYXR0cmlidXRlcyBwcmVkZWZpbmVkIGluIHRoZSBlbnZpcm9ubWVudC5cbiAgICogSWYgdGhlc2Ugc3VmZmljZSwgeW91IGRvbid0IG5lZWQgdG8gdXNlIHRoaXMgbWV0aG9kIGZvciB0aGUgc3ludGggc3RlcC5cbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZWJ1aWxkL2xhdGVzdC91c2VyZ3VpZGUvYnVpbGQtZW52LXJlZi1lbnYtdmFycy5odG1sXG4gICAqXG4gICAqIFdoYXQgYXR0cmlidXRlcyBhcmUgYXZhaWxhYmxlIGRlcGVuZHMgb24gdGhlIHR5cGUgb2Ygc291cmNlLiBUaGVzZSBhdHRyaWJ1dGVzXG4gICAqIGFyZSBzdXBwb3J0ZWQ6XG4gICAqXG4gICAqIC0gR2l0SHViLCBDb2RlQ29tbWl0LCBhbmQgQ29kZVN0YXJTb3VyY2VDb25uZWN0aW9uXG4gICAqICAgLSBgQXV0aG9yRGF0ZWBcbiAgICogICAtIGBCcmFuY2hOYW1lYFxuICAgKiAgIC0gYENvbW1pdElkYFxuICAgKiAgIC0gYENvbW1pdE1lc3NhZ2VgXG4gICAqIC0gR2l0SHViLCBDb2RlQ29tbWl0IGFuZCBFQ1JcbiAgICogICAtIGBSZXBvc2l0b3J5TmFtZWBcbiAgICogLSBHaXRIdWIgYW5kIENvZGVDb21taXRcbiAgICogICAtIGBDb21taXR0ZXJEYXRlYFxuICAgKiAtIEdpdEh1YlxuICAgKiAgIC0gYENvbW1pdFVybGBcbiAgICogLSBDb2RlU3RhclNvdXJjZUNvbm5lY3Rpb25cbiAgICogICAtIGBGdWxsUmVwb3NpdG9yeU5hbWVgXG4gICAqIC0gUzNcbiAgICogICAtIGBFVGFnYFxuICAgKiAgIC0gYFZlcnNpb25JZGBcbiAgICogLSBFQ1JcbiAgICogICAtIGBJbWFnZURpZ2VzdGBcbiAgICogICAtIGBJbWFnZVRhZ2BcbiAgICogICAtIGBJbWFnZVVSSWBcbiAgICogICAtIGBSZWdpc3RyeUlkYFxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9yZWZlcmVuY2UtdmFyaWFibGVzLmh0bWwjcmVmZXJlbmNlLXZhcmlhYmxlcy1saXN0XG4gICAqIEBleGFtcGxlXG4gICAqIC8vIEFjY2VzcyB0aGUgQ29tbWl0SWQgb2YgYSBHaXRIdWIgc291cmNlIGluIHRoZSBzeW50aFxuICAgKiBjb25zdCBzb3VyY2UgPSBwaXBlbGluZXMuQ29kZVBpcGVsaW5lU291cmNlLmdpdEh1Yignb3duZXIvcmVwbycsICdtYWluJyk7XG4gICAqXG4gICAqIGNvbnN0IHBpcGVsaW5lID0gbmV3IHBpcGVsaW5lcy5Db2RlUGlwZWxpbmUoc2NvcGUsICdNeVBpcGVsaW5lJywge1xuICAgKiAgIHN5bnRoOiBuZXcgcGlwZWxpbmVzLlNoZWxsU3RlcCgnU3ludGgnLCB7XG4gICAqICAgICBpbnB1dDogc291cmNlLFxuICAgKiAgICAgY29tbWFuZHM6IFtdLFxuICAgKiAgICAgZW52OiB7XG4gICAqICAgICAgICdDT01NSVRfSUQnOiBzb3VyY2Uuc291cmNlQXR0cmlidXRlKCdDb21taXRJZCcpLFxuICAgKiAgICAgfVxuICAgKiAgIH0pXG4gICAqIH0pO1xuICAgKi9cbiAgcHVibGljIHNvdXJjZUF0dHJpYnV0ZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBtYWtlQ29kZVBpcGVsaW5lT3V0cHV0KHRoaXMsIG5hbWUpO1xuICB9XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgR2l0SHViIHNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHaXRIdWJTb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIEEgR2l0SHViIE9BdXRoIHRva2VuIHRvIHVzZSBmb3IgYXV0aGVudGljYXRpb24uXG4gICAqXG4gICAqIEl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSBhIFNlY3JldHMgTWFuYWdlciBgU2VjcmV0YCB0byBvYnRhaW4gdGhlIHRva2VuOlxuICAgKlxuICAgKiBgYGB0c1xuICAgKiBjb25zdCBvYXV0aCA9IGNkay5TZWNyZXRWYWx1ZS5zZWNyZXRzTWFuYWdlcignbXktZ2l0aHViLXRva2VuJyk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBUaGUgR2l0SHViIFBlcnNvbmFsIEFjY2VzcyBUb2tlbiBzaG91bGQgaGF2ZSB0aGVzZSBzY29wZXM6XG4gICAqXG4gICAqICogKipyZXBvKiogLSB0byByZWFkIHRoZSByZXBvc2l0b3J5XG4gICAqICogKiphZG1pbjpyZXBvX2hvb2sqKiAtIGlmIHlvdSBwbGFuIHRvIHVzZSB3ZWJob29rcyAodHJ1ZSBieSBkZWZhdWx0KVxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9HaXRIdWItY3JlYXRlLXBlcnNvbmFsLXRva2VuLUNMSS5odG1sXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2VjcmV0VmFsdWUuc2VjcmV0c01hbmFnZXIoJ2dpdGh1Yi10b2tlbicpXG4gICAqL1xuICByZWFkb25seSBhdXRoZW50aWNhdGlvbj86IFNlY3JldFZhbHVlO1xuXG4gIC8qKlxuICAgKiBIb3cgQVdTIENvZGVQaXBlbGluZSBzaG91bGQgYmUgdHJpZ2dlcmVkXG4gICAqXG4gICAqIFdpdGggdGhlIGRlZmF1bHQgdmFsdWUgXCJXRUJIT09LXCIsIGEgd2ViaG9vayBpcyBjcmVhdGVkIGluIEdpdEh1YiB0aGF0IHRyaWdnZXJzIHRoZSBhY3Rpb24uXG4gICAqIFdpdGggXCJQT0xMXCIsIENvZGVQaXBlbGluZSBwZXJpb2RpY2FsbHkgY2hlY2tzIHRoZSBzb3VyY2UgZm9yIGNoYW5nZXMuXG4gICAqIFdpdGggXCJOb25lXCIsIHRoZSBhY3Rpb24gaXMgbm90IHRyaWdnZXJlZCB0aHJvdWdoIGNoYW5nZXMgaW4gdGhlIHNvdXJjZS5cbiAgICpcbiAgICogVG8gdXNlIGBXRUJIT09LYCwgeW91ciBHaXRIdWIgUGVyc29uYWwgQWNjZXNzIFRva2VuIHNob3VsZCBoYXZlXG4gICAqICoqYWRtaW46cmVwb19ob29rKiogc2NvcGUgKGluIGFkZGl0aW9uIHRvIHRoZSByZWd1bGFyICoqcmVwbyoqIHNjb3BlKS5cbiAgICpcbiAgICogQGRlZmF1bHQgR2l0SHViVHJpZ2dlci5XRUJIT09LXG4gICAqL1xuICByZWFkb25seSB0cmlnZ2VyPzogR2l0SHViVHJpZ2dlcjtcblxufVxuXG4vKipcbiAqIEV4dGVuZCBDb2RlUGlwZWxpbmVTb3VyY2Ugc28gd2UgY2FuIHR5cGUtdGVzdCBpbiB0aGUgQ29kZVBpcGVsaW5lRW5naW5lLlxuICovXG5jbGFzcyBHaXRIdWJTb3VyY2UgZXh0ZW5kcyBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IG93bmVyOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVwbzogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGF1dGhlbnRpY2F0aW9uOiBTZWNyZXRWYWx1ZTtcblxuICBjb25zdHJ1Y3RvcihyZXBvU3RyaW5nOiBzdHJpbmcsIHJlYWRvbmx5IGJyYW5jaDogc3RyaW5nLCByZWFkb25seSBwcm9wczogR2l0SHViU291cmNlT3B0aW9ucykge1xuICAgIHN1cGVyKHJlcG9TdHJpbmcpO1xuXG4gICAgY29uc3QgcGFydHMgPSByZXBvU3RyaW5nLnNwbGl0KCcvJyk7XG4gICAgaWYgKFRva2VuLmlzVW5yZXNvbHZlZChyZXBvU3RyaW5nKSB8fCBwYXJ0cy5sZW5ndGggIT09IDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgR2l0SHViIHJlcG9zaXRvcnkgbmFtZSBzaG91bGQgYmUgYSByZXNvbHZlZCBzdHJpbmcgbGlrZSAnPG93bmVyPi88cmVwbz4nLCBnb3QgJyR7cmVwb1N0cmluZ30nYCk7XG4gICAgfVxuICAgIHRoaXMub3duZXIgPSBwYXJ0c1swXTtcbiAgICB0aGlzLnJlcG8gPSBwYXJ0c1sxXTtcbiAgICB0aGlzLmF1dGhlbnRpY2F0aW9uID0gcHJvcHMuYXV0aGVudGljYXRpb24gPz8gU2VjcmV0VmFsdWUuc2VjcmV0c01hbmFnZXIoJ2dpdGh1Yi10b2tlbicpO1xuICAgIHRoaXMuY29uZmlndXJlUHJpbWFyeU91dHB1dChuZXcgRmlsZVNldCgnU291cmNlJywgdGhpcykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBhY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5HaXRIdWJTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgYWN0aW9uTmFtZSxcbiAgICAgIHJ1bk9yZGVyLFxuICAgICAgb2F1dGhUb2tlbjogdGhpcy5hdXRoZW50aWNhdGlvbixcbiAgICAgIG93bmVyOiB0aGlzLm93bmVyLFxuICAgICAgcmVwbzogdGhpcy5yZXBvLFxuICAgICAgYnJhbmNoOiB0aGlzLmJyYW5jaCxcbiAgICAgIHRyaWdnZXI6IHRoaXMucHJvcHMudHJpZ2dlcixcbiAgICAgIHZhcmlhYmxlc05hbWVzcGFjZSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIFMzIHNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTM1NvdXJjZU9wdGlvbnMge1xuICAvKipcbiAgICogSG93IHNob3VsZCBDb2RlUGlwZWxpbmUgZGV0ZWN0IHNvdXJjZSBjaGFuZ2VzIGZvciB0aGlzIEFjdGlvbi5cbiAgICogTm90ZSB0aGF0IGlmIHRoaXMgaXMgUzNUcmlnZ2VyLkVWRU5UUywgeW91IG5lZWQgdG8gbWFrZSBzdXJlIHRvIGluY2x1ZGUgdGhlIHNvdXJjZSBCdWNrZXQgaW4gYSBDbG91ZFRyYWlsIFRyYWlsLFxuICAgKiBhcyBvdGhlcndpc2UgdGhlIENsb3VkV2F0Y2ggRXZlbnRzIHdpbGwgbm90IGJlIGVtaXR0ZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IFMzVHJpZ2dlci5QT0xMXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FtYXpvbkNsb3VkV2F0Y2gvbGF0ZXN0L2V2ZW50cy9sb2ctczMtZGF0YS1ldmVudHMuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgdHJpZ2dlcj86IFMzVHJpZ2dlcjtcblxuICAvKipcbiAgICogVGhlIGFjdGlvbiBuYW1lIHVzZWQgZm9yIHRoaXMgc291cmNlIGluIHRoZSBDb2RlUGlwZWxpbmVcbiAgICpcbiAgICogQGRlZmF1bHQgLSBUaGUgYnVja2V0IG5hbWVcbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbk5hbWU/OiBzdHJpbmc7XG59XG5cbmNsYXNzIFMzU291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgYnVja2V0OiBJQnVja2V0LCBwcml2YXRlIHJlYWRvbmx5IG9iamVjdEtleTogc3RyaW5nLCByZWFkb25seSBwcm9wczogUzNTb3VyY2VPcHRpb25zKSB7XG4gICAgc3VwZXIoTm9kZS5vZihidWNrZXQpLmFkZHIpO1xuXG4gICAgdGhpcy5jb25maWd1cmVQcmltYXJ5T3V0cHV0KG5ldyBGaWxlU2V0KCdTb3VyY2UnLCB0aGlzKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0QWN0aW9uKG91dHB1dDogQXJ0aWZhY3QsIF9hY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5TM1NvdXJjZUFjdGlvbih7XG4gICAgICBvdXRwdXQsXG4gICAgICAvLyBCdWNrZXQgbmFtZXMgYXJlIGd1YXJhbnRlZWQgdG8gY29uZm9ybSB0byBBY3Rpb25OYW1lIHJlc3RyaWN0aW9uc1xuICAgICAgYWN0aW9uTmFtZTogdGhpcy5wcm9wcy5hY3Rpb25OYW1lID8/IHRoaXMuYnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICBydW5PcmRlcixcbiAgICAgIGJ1Y2tldEtleTogdGhpcy5vYmplY3RLZXksXG4gICAgICB0cmlnZ2VyOiB0aGlzLnByb3BzLnRyaWdnZXIsXG4gICAgICBidWNrZXQ6IHRoaXMuYnVja2V0LFxuICAgICAgdmFyaWFibGVzTmFtZXNwYWNlLFxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgRUNSIHNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFQ1JTb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIFRoZSBpbWFnZSB0YWcgdGhhdCB3aWxsIGJlIGNoZWNrZWQgZm9yIGNoYW5nZXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IGxhdGVzdFxuICAgKi9cbiAgcmVhZG9ubHkgaW1hZ2VUYWc/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBhY3Rpb24gbmFtZSB1c2VkIGZvciB0aGlzIHNvdXJjZSBpbiB0aGUgQ29kZVBpcGVsaW5lXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gVGhlIHJlcG9zaXRvcnkgbmFtZVxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uTmFtZT86IHN0cmluZztcbn1cblxuY2xhc3MgRUNSU291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcmVwb3NpdG9yeTogSVJlcG9zaXRvcnksIHJlYWRvbmx5IHByb3BzOiBFQ1JTb3VyY2VPcHRpb25zKSB7XG4gICAgc3VwZXIoTm9kZS5vZihyZXBvc2l0b3J5KS5hZGRyKTtcblxuICAgIHRoaXMuY29uZmlndXJlUHJpbWFyeU91dHB1dChuZXcgRmlsZVNldCgnU291cmNlJywgdGhpcykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBfYWN0aW9uTmFtZTogc3RyaW5nLCBydW5PcmRlcjogbnVtYmVyLCB2YXJpYWJsZXNOYW1lc3BhY2U6IHN0cmluZykge1xuICAgIC8vIFJlcG9zaXRvcnlOYW1lIGNhbiBjb250YWluICcvJyB0aGF0IGlzIG5vdCBhIHZhbGlkIEFjdGlvbk5hbWUgY2hhcmFjdGVyLCB1c2UgJ18nIGluc3RlYWRcbiAgICBjb25zdCBmb3JtYXR0ZWRSZXBvc2l0b3J5TmFtZSA9IEZuLmpvaW4oJ18nLCBGbi5zcGxpdCgnLycsIHRoaXMucmVwb3NpdG9yeS5yZXBvc2l0b3J5TmFtZSkpO1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5FY3JTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgYWN0aW9uTmFtZTogdGhpcy5wcm9wcy5hY3Rpb25OYW1lID8/IGZvcm1hdHRlZFJlcG9zaXRvcnlOYW1lLFxuICAgICAgcnVuT3JkZXIsXG4gICAgICByZXBvc2l0b3J5OiB0aGlzLnJlcG9zaXRvcnksXG4gICAgICBpbWFnZVRhZzogdGhpcy5wcm9wcy5pbWFnZVRhZyxcbiAgICAgIHZhcmlhYmxlc05hbWVzcGFjZSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgQ29kZVN0YXIgc291cmNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29ubmVjdGlvblNvdXJjZU9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgQ29kZVN0YXIgQ29ubmVjdGlvbiBjcmVhdGVkIGluIHRoZSBBV1MgY29uc29sZVxuICAgKiB0aGF0IGhhcyBwZXJtaXNzaW9ucyB0byBhY2Nlc3MgdGhpcyBHaXRIdWIgb3IgQml0QnVja2V0IHJlcG9zaXRvcnkuXG4gICAqXG4gICAqIEBleGFtcGxlICdhcm46YXdzOmNvZGVzdGFyLWNvbm5lY3Rpb25zOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6Y29ubmVjdGlvbi8xMjM0NTY3OC1hYmNkLTEyYWItMzRjZGVmNTY3OGdoJ1xuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9jb25uZWN0aW9ucy1jcmVhdGUuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgY29ubmVjdGlvbkFybjogc3RyaW5nO1xuXG5cbiAgLy8gbG9uZyBVUkwgaW4gQHNlZVxuICAvKipcbiAgICogSWYgdGhpcyBpcyBzZXQsIHRoZSBuZXh0IENvZGVCdWlsZCBqb2IgY2xvbmVzIHRoZSByZXBvc2l0b3J5IChpbnN0ZWFkIG9mIENvZGVQaXBlbGluZSBkb3dubG9hZGluZyB0aGUgZmlsZXMpLlxuICAgKlxuICAgKiBUaGlzIHByb3ZpZGVzIGFjY2VzcyB0byByZXBvc2l0b3J5IGhpc3RvcnksIGFuZCByZXRhaW5zIHN5bWxpbmtzIChzeW1saW5rcyB3b3VsZCBvdGhlcndpc2UgYmVcbiAgICogcmVtb3ZlZCBieSBDb2RlUGlwZWxpbmUpLlxuICAgKlxuICAgKiAqKk5vdGUqKjogaWYgdGhpcyBvcHRpb24gaXMgdHJ1ZSwgb25seSBDb2RlQnVpbGQgam9icyBjYW4gdXNlIHRoZSBvdXRwdXQgYXJ0aWZhY3QuXG4gICAqXG4gICAqIEBkZWZhdWx0IGZhbHNlXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZGVwaXBlbGluZS9sYXRlc3QvdXNlcmd1aWRlL2FjdGlvbi1yZWZlcmVuY2UtQ29kZXN0YXJDb25uZWN0aW9uU291cmNlLmh0bWwjYWN0aW9uLXJlZmVyZW5jZS1Db2Rlc3RhckNvbm5lY3Rpb25Tb3VyY2UtY29uZmlnXG4gICAqL1xuICByZWFkb25seSBjb2RlQnVpbGRDbG9uZU91dHB1dD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIENvbnRyb2xzIGF1dG9tYXRpY2FsbHkgc3RhcnRpbmcgeW91ciBwaXBlbGluZSB3aGVuIGEgbmV3IGNvbW1pdFxuICAgKiBpcyBtYWRlIG9uIHRoZSBjb25maWd1cmVkIHJlcG9zaXRvcnkgYW5kIGJyYW5jaC4gSWYgdW5zcGVjaWZpZWQsXG4gICAqIHRoZSBkZWZhdWx0IHZhbHVlIGlzIHRydWUsIGFuZCB0aGUgZmllbGQgZG9lcyBub3QgZGlzcGxheSBieSBkZWZhdWx0LlxuICAgKlxuICAgKiBAZGVmYXVsdCB0cnVlXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2NvZGVwaXBlbGluZS9sYXRlc3QvdXNlcmd1aWRlL2FjdGlvbi1yZWZlcmVuY2UtQ29kZXN0YXJDb25uZWN0aW9uU291cmNlLmh0bWxcbiAgICovXG4gIHJlYWRvbmx5IHRyaWdnZXJPblB1c2g/OiBib29sZWFuO1xufVxuXG5jbGFzcyBDb2RlU3RhckNvbm5lY3Rpb25Tb3VyY2UgZXh0ZW5kcyBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IG93bmVyOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVwbzogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHJlcG9TdHJpbmc6IHN0cmluZywgcmVhZG9ubHkgYnJhbmNoOiBzdHJpbmcsIHJlYWRvbmx5IHByb3BzOiBDb25uZWN0aW9uU291cmNlT3B0aW9ucykge1xuICAgIHN1cGVyKHJlcG9TdHJpbmcpO1xuXG4gICAgY29uc3QgcGFydHMgPSByZXBvU3RyaW5nLnNwbGl0KCcvJyk7XG4gICAgaWYgKFRva2VuLmlzVW5yZXNvbHZlZChyZXBvU3RyaW5nKSB8fCBwYXJ0cy5sZW5ndGggIT09IDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ29kZVN0YXIgcmVwb3NpdG9yeSBuYW1lIHNob3VsZCBiZSBhIHJlc29sdmVkIHN0cmluZyBsaWtlICc8b3duZXI+LzxyZXBvPicsIGdvdCAnJHtyZXBvU3RyaW5nfSdgKTtcbiAgICB9XG4gICAgdGhpcy5vd25lciA9IHBhcnRzWzBdO1xuICAgIHRoaXMucmVwbyA9IHBhcnRzWzFdO1xuICAgIHRoaXMuY29uZmlndXJlUHJpbWFyeU91dHB1dChuZXcgRmlsZVNldCgnU291cmNlJywgdGhpcykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBhY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5Db2RlU3RhckNvbm5lY3Rpb25zU291cmNlQWN0aW9uKHtcbiAgICAgIG91dHB1dCxcbiAgICAgIGFjdGlvbk5hbWUsXG4gICAgICBydW5PcmRlcixcbiAgICAgIGNvbm5lY3Rpb25Bcm46IHRoaXMucHJvcHMuY29ubmVjdGlvbkFybixcbiAgICAgIG93bmVyOiB0aGlzLm93bmVyLFxuICAgICAgcmVwbzogdGhpcy5yZXBvLFxuICAgICAgYnJhbmNoOiB0aGlzLmJyYW5jaCxcbiAgICAgIGNvZGVCdWlsZENsb25lT3V0cHV0OiB0aGlzLnByb3BzLmNvZGVCdWlsZENsb25lT3V0cHV0LFxuICAgICAgdHJpZ2dlck9uUHVzaDogdGhpcy5wcm9wcy50cmlnZ2VyT25QdXNoLFxuICAgICAgdmFyaWFibGVzTmFtZXNwYWNlLFxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciBhIENvZGVDb21taXQgc291cmNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29kZUNvbW1pdFNvdXJjZU9wdGlvbnMge1xuICAvKipcbiAgICogSG93IHNob3VsZCBDb2RlUGlwZWxpbmUgZGV0ZWN0IHNvdXJjZSBjaGFuZ2VzIGZvciB0aGlzIEFjdGlvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgQ29kZUNvbW1pdFRyaWdnZXIuRVZFTlRTXG4gICAqL1xuICByZWFkb25seSB0cmlnZ2VyPzogQ29kZUNvbW1pdFRyaWdnZXI7XG5cbiAgLyoqXG4gICAqIFJvbGUgdG8gYmUgdXNlZCBieSBvbiBjb21taXQgZXZlbnQgcnVsZS5cbiAgICogVXNlZCBvbmx5IHdoZW4gdHJpZ2dlciB2YWx1ZSBpcyBDb2RlQ29tbWl0VHJpZ2dlci5FVkVOVFMuXG4gICAqXG4gICAqIEBkZWZhdWx0IGEgbmV3IHJvbGUgd2lsbCBiZSBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZXZlbnRSb2xlPzogaWFtLklSb2xlO1xuXG4gIC8qKlxuICAgKiBJZiB0aGlzIGlzIHNldCwgdGhlIG5leHQgQ29kZUJ1aWxkIGpvYiBjbG9uZXMgdGhlIHJlcG9zaXRvcnkgKGluc3RlYWQgb2YgQ29kZVBpcGVsaW5lIGRvd25sb2FkaW5nIHRoZSBmaWxlcykuXG4gICAqXG4gICAqIFRoaXMgcHJvdmlkZXMgYWNjZXNzIHRvIHJlcG9zaXRvcnkgaGlzdG9yeSwgYW5kIHJldGFpbnMgc3ltbGlua3MgKHN5bWxpbmtzIHdvdWxkIG90aGVyd2lzZSBiZVxuICAgKiByZW1vdmVkIGJ5IENvZGVQaXBlbGluZSkuXG4gICAqXG4gICAqICoqTm90ZSoqOiBpZiB0aGlzIG9wdGlvbiBpcyB0cnVlLCBvbmx5IENvZGVCdWlsZCBqb2JzIGNhbiB1c2UgdGhlIG91dHB1dCBhcnRpZmFjdC5cbiAgICpcbiAgICogQGRlZmF1bHQgZmFsc2VcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvYWN0aW9uLXJlZmVyZW5jZS1Db2RlQ29tbWl0Lmh0bWxcbiAgICovXG4gIHJlYWRvbmx5IGNvZGVCdWlsZENsb25lT3V0cHV0PzogYm9vbGVhbjtcbn1cblxuY2xhc3MgQ29kZUNvbW1pdFNvdXJjZSBleHRlbmRzIENvZGVQaXBlbGluZVNvdXJjZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcmVwb3NpdG9yeTogY29kZWNvbW1pdC5JUmVwb3NpdG9yeSwgcHJpdmF0ZSByZWFkb25seSBicmFuY2g6IHN0cmluZywgcHJpdmF0ZSByZWFkb25seSBwcm9wczogQ29kZUNvbW1pdFNvdXJjZU9wdGlvbnMpIHtcbiAgICBzdXBlcihUb2tlbi5pc1VucmVzb2x2ZWQocmVwb3NpdG9yeS5yZXBvc2l0b3J5TmFtZSlcbiAgICAgID8gTm9kZS5vZihyZXBvc2l0b3J5KS5hZGRyXG4gICAgICA6IHJlcG9zaXRvcnkucmVwb3NpdG9yeU5hbWUpO1xuXG4gICAgdGhpcy5jb25maWd1cmVQcmltYXJ5T3V0cHV0KG5ldyBGaWxlU2V0KCdTb3VyY2UnLCB0aGlzKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0QWN0aW9uKG91dHB1dDogQXJ0aWZhY3QsIF9hY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5Db2RlQ29tbWl0U291cmNlQWN0aW9uKHtcbiAgICAgIG91dHB1dCxcbiAgICAgIC8vIEd1YXJhbnRlZWQgdG8gYmUgb2theSBhcyBhY3Rpb24gbmFtZVxuICAgICAgYWN0aW9uTmFtZTogdGhpcy5yZXBvc2l0b3J5LnJlcG9zaXRvcnlOYW1lLFxuICAgICAgcnVuT3JkZXIsXG4gICAgICBicmFuY2g6IHRoaXMuYnJhbmNoLFxuICAgICAgdHJpZ2dlcjogdGhpcy5wcm9wcy50cmlnZ2VyLFxuICAgICAgcmVwb3NpdG9yeTogdGhpcy5yZXBvc2l0b3J5LFxuICAgICAgZXZlbnRSb2xlOiB0aGlzLnByb3BzLmV2ZW50Um9sZSxcbiAgICAgIGNvZGVCdWlsZENsb25lT3V0cHV0OiB0aGlzLnByb3BzLmNvZGVCdWlsZENsb25lT3V0cHV0LFxuICAgICAgdmFyaWFibGVzTmFtZXNwYWNlLFxuICAgIH0pO1xuICB9XG59XG4iXX0=